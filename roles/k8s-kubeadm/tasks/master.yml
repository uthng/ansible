- block:
  - name: "Master | Copy pki certs generated by cluster initialization"
    shell: "scp root@{{ kubeadm_master_host_address }}:{{ kubeadm_pki_dir }}/{{ item }} ./"
    args:
      chdir: "{{ kubeadm_pki_dir }}"
    with_items: "{{ kubeadm_master_certs }}"

  - name: "Master | Join master control plane"
    shell: "kubeadm join {{ kubeadm_load_balancer_vip }}:6443 --token {{ kubeadm_join_token }} --discovery-token-ca-cert-hash {{ kubeadm_ca_hash }} --experimental-control-plane"

  when: inventory_hostname != kubeadm_master_host
  tags:
    - kubeadm-master-join
